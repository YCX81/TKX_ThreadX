# 系统级 FMEA

**项目**: TKX_ThreadX
**版本**: 1.0.0
**合规目标**: IEC 61508 SIL 2 / ISO 13849 PL d
**日期**: 2025-12-11
**作者**: [作者姓名]
**审核**: [审核人姓名]

---

## 1. 文档概述

### 1.1 目的

本文档对 TKX_ThreadX 功能安全系统进行失效模式与影响分析 (FMEA)。分析识别潜在失效模式、影响及实施的诊断措施。

### 1.2 范围

| 项目 | 描述 |
|------|------|
| 系统 | STM32F407VGT6 功能安全框架 |
| 硬件 | STM32F407VGT6 MCU (Cortex-M4, 168MHz) |
| 软件 | Bootloader + 应用程序 (ThreadX RTOS) |
| 安全目标 | IEC 61508 SIL 2 (DC ≥ 90%) |

### 1.3 参考文档

| 文档 | 描述 |
|------|------|
| UM1840 | STM32F4 系列安全手册 |
| AN5141 | STM32F4 系列微控制器 FMEA 结果 |
| AN5140 | STM32F4 系列微控制器 FMEDA 快照 |
| IEC 61508 | E/E/PE 系统功能安全 |
| ISO 13849 | 机械安全 |
| SN 29500 | 失效率数据 |
| IEC 62380 | 可靠性数据手册 |

### 1.4 技术参考

| 来源 | URL | 描述 |
|------|-----|------|
| ST X-CUBE-STL | https://www.st.com/en/embedded-software/x-cube-stl.html | STM32 功能安全软件测试库 |
| ST 安全手册 | https://www.st.com/resource/en/user_manual/um1840-stm32f4-series-safety-manual-stmicroelectronics.pdf | STM32F4 系列安全手册 (UM1840) |
| Microchip FMEDA | https://ww1.microchip.com/downloads/en/DeviceDoc/Failure-Mode-Effect-Diagnostics-Analysis-DS00003638A.pdf | FMEDA 重要性与方法论 |
| ADI 引脚 FMEA | https://www.analog.com/en/resources/technical-articles/know-your-safety-part-3.html | 引脚 FMEA 分析指南 |
| ADI 失效模式 | https://www.analog.com/en/resources/analog-dialogue/articles/know-your-safety-application-notes-part-2.html | 失效模式分布 |
| Memfault 看门狗 | https://interrupt.memfault.com/blog/firmware-watchdog-best-practices | 看门狗定时器最佳实践 |
| Barr Group | https://barrgroup.com/embedded-systems/how-to/top-five-nasty-firmware-bugs | 常见嵌入式固件缺陷 |
| Ganssle 看门狗 | https://www.ganssle.com/watchdogs.htm | 设计优秀的看门狗定时器 |

### 1.5 严重度分类

| 等级 | 严重度 | 描述 |
|------|--------|------|
| 1 | 灾难性 | 可能导致人员伤亡 |
| 2 | 严重 | 系统失效，安全功能丧失 |
| 3 | 较大 | 降级运行，安全裕度降低 |
| 4 | 轻微 | 轻微故障，无安全影响 |

### 1.6 诊断覆盖率分类

| 等级 | DC 范围 | 描述 |
|------|---------|------|
| 高 | ≥ 99% | 几乎完全故障检测 |
| 中 | 90% - 99% | 大多数故障可检测 |
| 低 | 60% - 90% | 基本故障检测 |
| 无 | < 60% | 最小或无检测 |

---

## 2. 系统架构概述

```
┌─────────────────────────────────────────────────────────────┐
│                    TKX_ThreadX 系统                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Bootloader  │  │   应用程序   │  │     安全监控        │  │
│  │ (48KB)      │  │ (448KB)     │  │                     │  │
│  │ - 自检      │  │ - ThreadX   │  │ - 看门狗            │  │
│  │ - CRC       │  │ - 应用逻辑  │  │ - 栈监控            │  │
│  │ - 参数验证  │  │ - 服务层    │  │ - 程序流监控        │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│                       硬件平台                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐   │
│  │ CPU 内核 │ │ Flash    │ │ RAM      │ │ 外设         │   │
│  │ Cortex-M4│ │ 1MB      │ │ 192KB    │ │ WDG,CRC,MPU  │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. FMEA 分析表

### 3.1 MCU 内核子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| CPU-01 | CPU 内核 | 指令执行错误 | 辐射、EMI、硅缺陷 | 计算错误 | 安全功能故障 | 2 | 程序流监控(签名验证) | 中 (90%) | 10ms | 运行时签名检查 |
| CPU-02 | CPU 内核 | 寄存器损坏 | 位翻转、EMI | 数据错误 | 输出错误 | 2 | 启动时 CPU 寄存器自检 | 高 (99%) | 启动时 | March-C 模式测试 |
| CPU-03 | CPU 内核 | 程序计数器错误 | 栈溢出、损坏 | 跳转到无效地址 | 系统崩溃 | 2 | MPU 保护 + 栈监控 | 中 (95%) | 立即 | MPU 触发 HardFault |
| CPU-04 | CPU 内核 | ALU 故障 | 硬件缺陷 | 计算错误 | 安全决策错误 | 2 | 启动时 ALU 测试 + 冗余计算 | 中 (90%) | 启动/运行时 | 关键计算使用冗余 |
| CPU-05 | 时钟 | 频率漂移 | 振荡器老化、温度 | 时序错误 | 通信失败 | 3 | 时钟监控 (HSE vs LSI) | 高 (99%) | 1ms | 硬件时钟安全系统 |
| CPU-06 | 时钟 | 时钟失效(停止) | 晶振失效 | 系统停止 | 完全失效 | 2 | 使用 LSI 时钟的 IWDG | 高 (99%) | 100ms | 独立看门狗使用独立时钟 |
| CPU-07 | 中断 | 中断未响应 | 优先级反转、禁用 | 响应延迟 | 安全响应延迟 | 3 | 看门狗超时 | 中 (90%) | 可配置 | 基于令牌的看门狗 |
| CPU-08 | 中断 | 虚假中断 | EMI、软件错误 | 意外执行 | 不可预测行为 | 3 | 默认中断处理 + 错误记录 | 低 (70%) | 立即 | 捕获意外中断 |

### 3.2 存储器子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| MEM-01 | Flash | 单比特翻转 | 辐射、保持性丧失 | 代码/数据损坏 | 程序故障 | 2 | CRC32 校验(启动+增量) | 高 (99%) | 启动:全量, 运行:增量 | 4KB 块，后台检查 |
| MEM-02 | Flash | 多比特损坏 | 编程错误、磨损 | 大量数据损坏 | 系统失效 | 1 | CRC32 + 冗余存储 | 高 (99%) | 启动时 | 关键参数双重存储 |
| MEM-03 | Flash | 扇区擦除失败 | 磨损、掉电 | 无法更新配置 | 配置卡死 | 3 | 写入验证 | 中 (90%) | 写入时 | 写后读回 |
| MEM-04 | Flash | 固定为 0/1 | 存储单元退化 | 持久错误 | 数据完整性丧失 | 2 | CRC 覆盖所有 Flash 区域 | 高 (99%) | 增量检查 | 运行时 CRC 覆盖 |
| MEM-05 | SRAM | 单比特翻转 | 辐射、α粒子 | 变量损坏 | 计算错误 | 2 | March-C 测试(启动) + ECC(如可用) | 中 (90%) | 启动时 | 启动时全 RAM 测试 |
| MEM-06 | SRAM | 地址线故障 | PCB 缺陷、焊点 | 访问错误地址 | 数据混乱 | 2 | 带地址模式的 March-C | 高 (99%) | 启动时 | 地址唯一性测试 |
| MEM-07 | SRAM | 数据线故障 | PCB 缺陷 | 写入错误数据 | 数据损坏 | 2 | 带数据模式的 March-C | 高 (99%) | 启动时 | 行走 1/0 模式 |
| MEM-08 | CCM RAM | 栈溢出 | 递归调用、大局部变量 | 内存损坏 | 系统崩溃 | 2 | 栈水印监控 | 中 (95%) | 10ms | 线程栈使用检查 |
| MEM-09 | CCM RAM | 栈下溢 | 返回地址损坏 | 跳转到无效代码 | 系统崩溃 | 2 | MPU 栈区域保护 | 中 (90%) | 立即 | 违规触发 HardFault |
| MEM-10 | MPU | 配置错误 | 软件错误 | 保护错误 | 安全漏洞 | 3 | 启动时 MPU 配置验证 | 中 (90%) | 启动时 | 读回并验证 |

### 3.3 安全监控子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| SAF-01 | IWDG | 看门狗未喂 | 软件挂起 | 系统复位 | 非受控重启 | 3 | 预期行为(故障安全) | N/A | 超时周期 | 设计行为 |
| SAF-02 | IWDG | 看门狗禁用 | 软件错误 | 无超时保护 | 挂起未检测 | 1 | 硬件 IWDG 无法禁用 | 高 (99%) | N/A | 一旦启用，永远开启 |
| SAF-03 | IWDG | 超时错误 | 配置错误 | 超时过长/短 | 检测延迟 | 3 | 超时值验证 | 中 (90%) | 启动时 | 读回配置 |
| SAF-04 | WWDG | 窗口违规 | 时序错误 | 系统复位 | 非受控重启 | 3 | 预期行为(故障安全) | N/A | N/A | 设计行为 |
| SAF-05 | CRC 单元 | CRC 计算错误 | 硬件故障 | CRC 值错误 | 误通过/失败 | 2 | 启动时已知答案测试 | 高 (99%) | 启动时 | 计算已知数据的 CRC |
| SAF-06 | 程序流 | 签名不匹配 | 代码路径错误 | 执行顺序错误 | 安全逻辑绕过 | 2 | 运行时签名验证 | 中 (90%) | 每函数 | 入口/出口签名检查 |
| SAF-07 | 程序流 | 签名溢出 | 计数器回绕 | 假匹配 | 漏检 | 3 | 带范围检查的 32 位计数器 | 低 (80%) | N/A | 32 位不太可能 |
| SAF-08 | 栈监控 | 监控线程阻塞 | 优先级反转 | 无栈检查 | 溢出未检测 | 2 | 看门狗监控监控线程 | 中 (90%) | 看门狗超时 | 监控有自己的令牌 |
| SAF-09 | 安全状态 | 卡在错误状态 | 状态机错误 | 无法转换 | 安全动作阻塞 | 2 | 状态超时 + 冗余状态变量 | 中 (90%) | 可配置 | 双重状态存储 |
| SAF-10 | 安全输出 | 输出卡死 | 驱动失效、短路 | 无法达到安全状态 | 危险状态 | 1 | 输出反馈监控 | 中 (90%) | 10ms | 读回输出状态 |

### 3.4 Bootloader 子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| BL-01 | 启动 | 自检跳过 | 代码损坏、跳转错误 | 无验证 | 故障系统运行 | 1 | 固定入口点 + 代码签名 | 高 (99%) | 启动时 | 复位向量受保护 |
| BL-02 | 启动 | 自检误通过 | 测试代码错误 | 故障未检测 | 故障系统运行 | 1 | 自检代码 CRC + 已知答案测试 | 中 (90%) | 启动时 | 测试测试本身 |
| BL-03 | CRC 检查 | 错误的 CRC 参考 | Flash 损坏 | 总是通过或失败 | 验证错误 | 2 | CRC 冗余存储(反转副本) | 高 (99%) | 启动时 | 双重存储比较 |
| BL-04 | 参数加载 | 加载无效参数 | Flash 损坏 | 配置错误 | 系统配置错误 | 2 | 参数范围检查 + CRC | 中 (95%) | 启动时 | 边界检查 |
| BL-05 | 参数加载 | 错误使用默认参数 | 代码错误 | 默认值错误 | 意外行为 | 3 | 默认值验证 | 中 (90%) | 启动时 | 默认值在安全范围内 |
| BL-06 | 应用跳转 | 跳转到损坏的应用 | CRC 未检查 | 执行坏代码 | 系统崩溃/故障 | 1 | 跳转前强制 CRC | 高 (99%) | 启动时 | CRC 失败不跳转 |
| BL-07 | 应用跳转 | 跳转地址错误 | 地址损坏 | 跳转到随机位置 | 系统崩溃 | 1 | 地址验证 + 签名检查 | 高 (99%) | 启动时 | 检查应用头 |
| BL-08 | 启动计数 | 计数器溢出 | 多次复位 | 计数器回绕 | 启动限制绕过 | 4 | 32 位计数器，成功后复位 | 低 (70%) | N/A | 非安全影响 |
| BL-09 | 工厂模式 | 意外进入工厂模式 | 内存损坏 | 系统处于测试模式 | 安全功能可能禁用 | 2 | 工厂模式需要调试器 + 特定序列 | 中 (90%) | 启动时 | 多步激活 |

### 3.5 应用程序子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| APP-01 | ThreadX | 内核崩溃 | 内存损坏、栈溢出 | 所有线程停止 | 系统失效 | 1 | 看门狗超时 | 高 (99%) | 超时周期 | IWDG 复位系统 |
| APP-02 | ThreadX | 线程死锁 | 资源竞争 | 线程阻塞 | 部分功能丧失 | 2 | 每线程基于令牌的看门狗 | 中 (90%) | 令牌超时 | 每个线程有令牌 |
| APP-03 | ThreadX | 优先级反转 | 互斥锁使用 | 高优先级延迟 | 响应时间超标 | 3 | 启用优先级继承 | 中 (90%) | N/A | ThreadX 特性 |
| APP-04 | 安全线程 | 线程未调度 | 饥饿 | 无安全监控 | 故障未检测 | 1 | 最高优先级 + 看门狗 | 高 (99%) | 看门狗超时 | 安全线程最高优先级 |
| APP-05 | 通信线程 | 消息丢失 | 缓冲区溢出 | 命令未处理 | 功能未执行 | 3 | 序列号 + 确认 | 中 (90%) | 消息超时 | 协议级检查 |
| APP-06 | 通信线程 | 消息损坏 | EMI、位错误 | 命令错误 | 动作错误 | 2 | 消息 CRC | 高 (99%) | 接收时 | 消息 CRC 检查 |
| APP-07 | 参数服务 | 参数超范围 | 输入错误、损坏 | 配置无效 | 不可预测行为 | 2 | 所有参数范围检查 | 中 (95%) | 访问时 | 边界检查 |
| APP-08 | 诊断服务 | 诊断禁用 | 软件错误 | 无诊断 | 故障未报告 | 3 | 诊断启用检查 | 低 (70%) | 运行时 | 状态监控 |

### 3.6 通信子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| COM-01 | CAN | 总线关闭 | EMI、短路 | 无通信 | 失去控制 | 2 | 总线关闭检测 + 自动恢复 | 高 (99%) | 立即 | 硬件检测 |
| COM-02 | CAN | 消息丢失 | 缓冲区溢出、冲突 | 命令丢失 | 功能未执行 | 3 | 心跳 + 序列号 | 中 (90%) | 心跳周期 | 协议监控 |
| COM-03 | CAN | 消息延迟 | 总线负载、优先级 | 响应延迟 | 时序违规 | 3 | 消息时间戳 + 超时 | 中 (90%) | 接收时 | 时间检查 |
| COM-04 | CAN | 错误消息 | 地址错误、损坏 | 错误节点响应 | 错误动作 | 2 | 节点 ID + 消息 CRC | 高 (99%) | 接收时 | 协议 CRC |
| COM-05 | UART | 帧错误 | 波特率不匹配 | 数据损坏 | 命令错误 | 3 | 帧错误检测 | 高 (99%) | 接收时 | 硬件检测 |
| COM-06 | UART | 缓冲区溢出 | 数据速率高 | 数据丢失 | 消息不完整 | 3 | DMA + 流控制 | 中 (90%) | 接收时 | 缓冲区监控 |
| COM-07 | CAN | 位填充错误 | EMI、噪声 | 帧错误 | 消息拒绝 | 3 | 错误计数器监控 | 高 (99%) | 立即 | 硬件检测 |
| COM-08 | CAN | 仲裁丢失 | 总线竞争 | 发送延迟 | 时序影响 | 4 | 重试机制 | 中 (90%) | 发送时 | 正常 CAN 行为 |
| COM-09 | SPI | 总线锁定 | 从设备无响应 | 通信挂起 | 外设不可用 | 3 | 超时 + 总线复位 | 中 (90%) | 可配置 | 软件超时 |
| COM-10 | I2C | 总线卡死 (SDA/SCL 低) | 从设备挂起、噪声 | 无通信 | 外设不可用 | 3 | 总线恢复序列 | 中 (90%) | 可配置 | 时钟拉伸超时 |

### 3.7 电源子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| PWR-01 | VDD | 欠压 | 电源故障、高负载 | 不稳定运行 | 系统崩溃、数据损坏 | 1 | PVD (可编程电压检测器) | 高 (99%) | <1ms | 硬件检测 |
| PWR-02 | VDD | 过压 | 稳压器故障 | 元件损坏 | 永久故障 | 1 | 外部电压监控 | 中 (90%) | 10ms | 需要外部电路 |
| PWR-03 | 电压稳压器 | 输出=输入 (直通) | 通道元件损坏 | MCU 过压 | 元件损坏 | 1 | MCU 引脚电压监控 | 中 (90%) | 10ms | 关键失效模式 |
| PWR-04 | 电压稳压器 | 输出漂移 | 温度、老化 | 超规格运行 | 边缘运行 | 3 | ADC 电压监控 | 中 (90%) | 100ms | 周期检查 |
| PWR-05 | VBAT | 电池故障 | 放电、老化 | RTC/备份丢失 | 掉电时时间/数据丢失 | 4 | 电池电压检查 | 低 (80%) | 启动时 | 非安全影响 |
| PWR-06 | 复位电路 | 虚假复位 | 噪声、ESD | 意外重启 | 服务中断 | 3 | 复位源识别 | 中 (95%) | 启动时 | 记录复位原因 |
| PWR-07 | 复位电路 | 复位卡在激活 | 硬件故障 | 系统无法启动 | 完全故障 | 1 | 外部复位监控 | 低 (70%) | N/A | 需要外部看门狗 |
| PWR-08 | 电源时序 | 时序错误 | 设计错误、元件故障 | 闩锁、损坏 | 元件故障 | 1 | 上电自检验证 | 中 (90%) | 启动时 | 检查所有电源轨 |

### 3.8 ADC 子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| ADC-01 | ADC | 转换错误 | 噪声、参考漂移 | 读数错误 | 决策错误 | 2 | 参考电压检查 + 平均 | 中 (90%) | 转换时 | 多次采样 |
| ADC-02 | ADC | 值卡死 | 硬件故障 | 恒定读数 | 信号变化漏检 | 2 | 合理性检查 (值变化监控) | 中 (90%) | 100ms | 期望变化 |
| ADC-03 | ADC | 输入开路 | 连接器故障、PCB 故障 | 浮空输入、随机值 | 不可预测读数 | 2 | 输入阻抗检查 / 上拉检测 | 中 (90%) | 转换时 | 检查浮空 |
| ADC-04 | ADC | 输入短路到 VDD | 接线故障 | 总是最大值 | 假高读数 | 2 | 范围合理性检查 | 高 (99%) | 转换时 | 超范围检测 |
| ADC-05 | ADC | 输入短路到 GND | 接线故障 | 总是零 | 假低读数 | 2 | 范围合理性检查 | 高 (99%) | 转换时 | 超范围检测 |
| ADC-06 | ADC | 参考电压漂移 | 温度、老化 | 增益误差 | 所有读数偏移 | 2 | 校准通道检查 | 中 (95%) | 周期性 | 使用内部参考 |
| ADC-07 | ADC | 通道串扰 | 多路复用器泄漏 | 读数受其他通道影响 | 值不正确 | 3 | 通道隔离测试 | 低 (80%) | 周期性 | 空转换 |
| ADC-08 | ADC | 超时 (无转换完成) | 时钟故障、外设挂起 | 无新数据 | 使用陈旧数据 | 2 | 转换超时监控 | 高 (99%) | 可配置 | ADC 看门狗 |

### 3.9 GPIO 和外部接口子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| GPIO-01 | 输出引脚 | 卡高 | 驱动故障、短路到 VDD | 无法拉低 | 输出卡死 | 2 | 回读验证 | 高 (99%) | 写入时 | 比较输出寄存器 |
| GPIO-02 | 输出引脚 | 卡低 | 驱动故障、短路到 GND | 无法拉高 | 输出卡死 | 2 | 回读验证 | 高 (99%) | 写入时 | 比较输出寄存器 |
| GPIO-03 | 输出引脚 | 开路 (高阻) | 键合线断裂、PCB 故障 | 无驱动能力 | 输出浮空 | 2 | 电流监控 / 上拉检查 | 中 (90%) | 周期性 | 外部检测 |
| GPIO-04 | 输入引脚 | 值卡死 | ESD 损坏、闩锁 | 输入状态错误 | 输入变化漏检 | 2 | 合理性检查 (期望跳变) | 中 (90%) | 运行时 | 应用相关 |
| GPIO-05 | 输入引脚 | 浮空 | 缺少上/下拉、开路 | 随机读数 | 不可预测行为 | 3 | 配置内部上/下拉 | 高 (99%) | 配置时 | 硬件特性 |
| GPIO-06 | 输入引脚 | 短路到相邻引脚 | 焊桥、污染 | 信号耦合 | 输入值错误 | 2 | 引脚隔离测试 | 低 (80%) | 启动时 | 测试模式检查 |
| GPIO-07 | 外部中断 | 未触发 | 配置错误、引脚故障 | 事件漏检 | 功能未执行 | 2 | 周期性中断测试 / 超时 | 中 (90%) | 可配置 | 心跳检查 |
| GPIO-08 | 外部中断 | 虚假触发 | 噪声、ESD | 意外 ISR 执行 | 行为错误 | 3 | 消抖 + ISR 中验证 | 中 (90%) | 立即 | 软件滤波 |

### 3.10 定时器子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| TIM-01 | 定时器 | 计数器卡死 | 硬件故障 | 无时序更新 | 定时功能失效 | 2 | 与独立定时器交叉检查 | 高 (99%) | 10ms | 使用两个定时器 |
| TIM-02 | 定时器 | 频率错误 | 预分频错误、时钟问题 | 时序不正确 | 时序违规 | 2 | 与 RTC/外部参考比较 | 中 (95%) | 周期性 | 交叉参考 |
| TIM-03 | 定时器 | 中断未生成 | 配置错误 | 事件漏检 | 功能未调用 | 2 | 中断发生监控 | 中 (90%) | 期望周期 | 计数中断 |
| TIM-04 | 定时器 | PWM 输出卡死 | 硬件故障、配置错误 | 占空比错误 | 执行器故障 | 2 | 输出反馈监控 | 中 (90%) | PWM 周期 | 回读或传感器 |
| TIM-05 | 定时器 | 输入捕获漏检 | 信号过快、噪声 | 测量错误 | 频率/周期错误 | 3 | 捕获值合理性检查 | 中 (90%) | 捕获时 | 范围验证 |
| TIM-06 | RTC | 时间漂移 | 晶振老化、温度 | 时间不准确 | 调度错误 | 4 | 周期性与外部参考同步 | 低 (80%) | 小时/天 | 通常非安全 |
| TIM-07 | SysTick | 滴答漏检 | 高中断负载 | RTOS 时序受影响 | 线程调度影响 | 2 | 滴答计数器验证 | 中 (95%) | 1ms | 监控滴答计数 |

### 3.11 DMA 子系统

| ID | 组件 | 失效模式 | 原因 | 局部影响 | 系统影响 | 严重度 | 诊断措施 | DC | 检测时间 | 备注 |
|----|------|----------|------|----------|----------|--------|----------|-----|----------|------|
| DMA-01 | DMA | 传输错误 | 总线故障、地址错误 | 数据未传输 | 外设故障 | 2 | DMA 错误中断 + 标志检查 | 高 (99%) | 立即 | 硬件检测 |
| DMA-02 | DMA | 传输不完整 | 超时、外设问题 | 部分数据 | 数据损坏 | 2 | 传输完成标志验证 | 高 (99%) | 完成时 | 检查 TC 标志 |
| DMA-03 | DMA | 源/目标地址错误 | 配置错误 | 数据到错误位置 | 内存损坏 | 1 | 使能前地址验证 | 中 (90%) | 配置时 | 范围检查 |
| DMA-04 | DMA | FIFO 上溢/下溢 | 速度不匹配 | 数据丢失 | 通信错误 | 3 | FIFO 错误标志监控 | 高 (99%) | 立即 | 硬件检测 |
| DMA-05 | DMA | 优先级冲突 | 配置错误 | 传输延迟 | 时序违规 | 3 | 传输时序监控 | 中 (90%) | 运行时 | 性能检查 |

---

## 4. 诊断覆盖率汇总

### 4.1 按子系统

| 子系统 | 失效模式总数 | 高 DC (≥99%) | 中 DC (90-99%) | 低 DC (<90%) | 平均 DC |
|--------|-------------|--------------|----------------|--------------|---------|
| MCU 内核 | 8 | 3 | 4 | 1 | 92% |
| 存储器 | 10 | 5 | 5 | 0 | 95% |
| 安全监控 | 10 | 3 | 6 | 1 | 91% |
| Bootloader | 9 | 4 | 4 | 1 | 93% |
| 应用程序 | 8 | 2 | 5 | 1 | 90% |
| 通信 | 10 | 5 | 5 | 0 | 94% |
| 电源 | 8 | 1 | 5 | 2 | 88% |
| ADC | 8 | 3 | 4 | 1 | 92% |
| GPIO/外部接口 | 8 | 3 | 4 | 1 | 92% |
| 定时器 | 7 | 1 | 5 | 1 | 91% |
| DMA | 5 | 3 | 2 | 0 | 95% |
| **合计** | **91** | **33** | **49** | **9** | **92%** |

### 4.2 按严重度

| 严重度 | 数量 | 高 DC | 中 DC | 低 DC |
|--------|------|-------|-------|-------|
| 灾难性 (1) | 12 | 6 | 4 | 2 |
| 严重 (2) | 50 | 20 | 27 | 3 |
| 较大 (3) | 25 | 6 | 16 | 3 |
| 轻微 (4) | 4 | 1 | 2 | 1 |

### 4.3 SIL 2 符合性评估

| 要求 | 目标 | 实现 | 状态 |
|------|------|------|------|
| 诊断覆盖率 (DC) | ≥ 90% | 92% | 通过 |
| 灾难性失效高 DC 覆盖 | 100% | 50% (6/12) | 待审 |
| 安全失效分数 (SFF) | ≥ 90% | ~92% | 通过 |

**注意**: 多个灾难性失效模式具有中等或低 DC。以下需要额外缓解措施:
- PWR-02 (过压): 中 DC - 增加外部过压保护电路
- PWR-03 (稳压器直通): 中 DC - 增加二级电压监控
- PWR-07 (复位卡死): 低 DC - 增加外部看门狗 IC
- PWR-08 (电源时序): 中 DC - 增加时序监控 IC
- DMA-03 (地址错误): 中 DC - 配置 MPU 区域保护 DMA

---

## 5. 风险缓解措施

### 5.1 高优先级措施 (灾难性失效)

| ID | 失效模式 | 当前 DC | 建议措施 | 目标 DC | 优先级 |
|----|----------|---------|----------|---------|--------|
| PWR-01 | 欠压 | 99% | PVD 已实现 - 验证阈值设置 | 99% | 验证 |
| PWR-02 | 过压 | 90% | 增加 TVS 二极管 + 外部电压监控 IC | 99% | 高 |
| PWR-03 | 稳压器直通 | 90% | 增加带交叉检查的冗余 LDO | 99% | 高 |
| PWR-07 | 复位卡死 | 70% | 增加外部看门狗 IC (如 MAX6369) | 95% | 高 |
| PWR-08 | 电源时序 | 90% | 增加电源时序/监控 IC | 99% | 中 |
| DMA-03 | DMA 地址错误 | 90% | 配置 MPU 保护关键区域 | 99% | 中 |

### 5.2 中优先级措施 (低 DC 的严重失效)

| ID | 失效模式 | 当前 DC | 建议措施 | 目标 DC | 优先级 |
|----|----------|---------|----------|---------|--------|
| SAF-10 | 输出卡死 | 90% | 增加带交叉监控的冗余输出驱动 | 99% | 中 |
| CPU-08 | 虚假中断 | 70% | 实现中断频率监控 | 90% | 中 |
| SAF-07 | 签名溢出 | 80% | 添加显式溢出检查和复位 | 95% | 中 |
| ADC-07 | 通道串扰 | 80% | 通道切换间增加空转换 | 90% | 低 |
| GPIO-06 | 引脚短路到相邻 | 80% | 增加启动时引脚隔离测试 | 90% | 低 |

### 5.3 监控建议

| 项目 | 建议 | 优先级 |
|------|------|--------|
| Flash 磨损 | 为配置扇区实现写入周期计数器 | 中 |
| RAM 健康 | 考虑在空闲时间进行周期性 RAM 测试 | 低 |
| 时钟漂移 | 记录频率偏差趋势 | 低 |
| 电源轨 | 周期性 ADC 测量所有电源轨 | 中 |
| 温度 | 监控 MCU 结温 | 中 |

### 5.4 硬件设计建议

| 领域 | 建议 | 理由 |
|------|------|------|
| 电源 | 增加灾难性过压保护电路 | 防止稳压器故障 |
| 电源 | 使用带电压监控的监控 IC | 独立电压验证 |
| 复位 | 使用独立振荡器的外部看门狗 | 检测主振荡器故障 |
| 通信 | 为 CAN/SPI/I2C 增加总线隔离 | 防止总线故障传播 |
| ADC | 尽可能使用差分输入 | 提高噪声抗扰度 |
| GPIO | 在关键输出上增加串联电阻 | 短路保护限流 |

---

## 6. 修订历史

| 版本 | 日期 | 作者 | 变更 |
|------|------|------|------|
| 1.0.0 | 2025-12-11 | [作者] | 初始发布 |

---

## 7. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 作者 | | | |
| 审核人 | | | |
| 批准人 | | | |
